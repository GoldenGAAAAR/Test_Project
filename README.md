Задача: разработать систему для мониторинга состояния сетевых устройств

Функциональные Требования: 
• Перед началом мониторинга, система должна подключиться к каждому устройству и настроить его так, чтобы устройство стало доступным для ICMP пинга. 
• Система должна опрашивать состояние устройств через ICMP (ping). • Результаты опроса должны записываться в лог-файл, содержащий информацию о времени опроса, IP-адресе устройства и результате опроса. 
• В случае, если устройство не отвечает более N раз, система должна отправлять уведомления администратору на почтовый ящик. 
• На вход системе подается YAML файл, содержащий: 
    • Список устройств и данные для их подключения. 
    • Путь к файлу для логирования. 
    • Почтовый ящик для отправки уведомлений. • Количество неудачных попыток подключения, после которых следует отправить уведомление.

Requirements:
    Python 3.9+
    Pyats
    PyYAML

Было принято решение выполнить это задание с помощью фреймворка Pyats (фреймворк, разработанный компанией Cisco для автоматизации тестирования и валидации сетевых устройств и инфраструктуры). Он предоставляет набор инструментов для создания, запуска и анализа автоматизированных тестов, а также для работы с сетевым оборудованием.

Файлы в директории:

test_task_job.py - 
    Управляющий файл, используемый для запуска кода. 

test_task_script.py - 
    Основной файл, в котором описаны сами тесты, которые будут проводится на сетевых устройствах.
Он включает в себя функции получения данных с Yaml файла, отправки письма на Email, инициализации логгирования и создания файла с логами, а также подключение к сетевым устройствам с помощью протокола SSH, непосредственно сами тесты и отключение от устройств. Логика программы описана в одном файле, так как имеет достаточно небольшой объём. В начале объявляем функцию open_yaml, которая открывает на чтение файл config.yaml и записывает данные в переменную. Следующая функиця - функция отправки электронного письма через SMTP сервер. Из config.yaml мы получаем адрес SMTP-сервера, имя отправителя, пароль, имя получателя, формируем письмо, отправляем письмо и закрываем сервер. В функции создания файла с логами мы создаем объект логгера, который можно использовать для записи лого, устанавливаем уровень логирования для логгера на уровне INFO, проверяем, существует ли файл журнала в пути, указанном в config. Если файл существует, он удаляется.
Создаем обработчик файла (FileHandler) для записи логов в файл по пути, указанному в config['log_path'], создаем форматтер для форматирования сообщений журнала. В данном случае, используется формат, который включает дату и время, имя логгера, уровень логирования и текст сообщения. Применяем созданный форматтер к обработчику файла и добавляем обработчик файла к объекту логгера, чтобы все сообщения журнала отправлялись в указанный файл.
    Далее выполняется раздел настройки перед непосредственным запуском тестов. В нем выполняется подключение к устройствам, указанным в файле testbed.yaml, после чего ссылки на подключенные
устройства сохраняются, чтобы их можно было использовать в других частях кода. После него идет непосредственно секция с тестами, вначале мы выполняем функцию настройки параметров на устройствах, чтобы снять ограничение на скорость передачи ICMP пакетов. В функции send_ping мы вызываем ранее определенные функции open_yaml и create_log, далее для каждого из устройств в цикле мы делаем пинг, если он успешен - выходим из цикла, если же нет - повторяем отправку столько раз, сколько указано в config.yaml. Если же пинг так и не прошел, вызывается ранее определенная функция send_email_notification. Далее следует отключение от устройств и завершение работы скрипта. На выходе мы получаем файл с логами в пути, указанном в config.yaml и письмо на электронной почте, содержащее в себе название устройства, по которому не прошел пинг и максимально возможное количество попыток

testbed.yaml - 
    файл, описывающий сетевые устройства, на которых проводятся тесты

config.yaml -
    файл, содержащий в себе такую информацию, как: максимальное количество попыток на пинг устройства, путь до файла с логами, SMTP адрес, имена отправителя и получателия, пароль отправителя

Тесты проводились на сети, созданной с помощью эмулятора gns3. На ПК был создан сетевой интерфейс, замкнутый сам на себя с адресом 192.168.70.1. В gns3 был выбран образ cloud, имитирующий нашу сеть и соединенный последовательно с двумя роутерами. Роутеру R1 на интерфейсы fa0/1 и fa0/0 были присовены IP-адреса 192.168.70.2 и 192.168.20.1 соответственно, роутеру R2 на fa0/0 - 192.168.20.2. В терминале компьютера и в роутере R2 были прописаны маршруты для статической марщрутизации, также на каждом из роутеров было настроено подключение по ssh. Также были прописаны настройки для успешного принятия ICMP пинга. 

Для создания избыточной и расширяемой архитектуры можно внести некоторые улучшения в текущую структуру, например параллелизация поможет улучшить производительность (лучше перераспределять нагрузку), можно добавить более сложную и детальную обработку ошибок, введение уровней тревог и распределение оповещений на основе важности, отправка оповещений не только по email, но и с помощью интеграции с различными корпоративными мессенджерами, автоматический запуск скриптов после определенных событий, реализация подключения с помощью VPN и шифрования, для более безопасного соединения. Данные улучшения могут быть реализованы, но на их создание потребуется большее количество времени



